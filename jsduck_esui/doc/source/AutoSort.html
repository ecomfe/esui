<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='global-property-'>/**
</span> * ESUI (Enterprise Simple UI)
 * Copyright 2013 Baidu Inc. All rights reserved.
 *
 * @ignore
 * @file 表格自动排序扩展
 * @author otakustay
 */
define(
    function (require) {
        var u = require('underscore');
        var Table = require('../Table');
        var Extension = require('../Extension');

<span id='extension-AutoSort-method-constructor'><span id='extension-AutoSort'>        /**
</span></span>         * 表格自动排序扩展
         *
         * 当表格加上此扩展后，其排序功能将由扩展自动提供
         *
         * 扩展默认使用简单的两值相减（字符串用`localeCompare`）的方法判断大小，
         * 也可以在表格具体列的配置中给出`comparer`属性来提供自定义的排序算法
         *
         * @class extension.AutoSort
         * @extends Extension
         * @constructor
         */
        function AutoSort() {
            Extension.apply(this, arguments);
        }

<span id='extension-AutoSort-property-type'>        /**
</span>         * 指定扩展类型，始终为`&quot;AutoSort&quot;`
         *
         * @type {string}
         */
        AutoSort.prototype.type = 'AutoSort';

        function sort(e) {
            var computeDiff = e.field.comparer;
            if (!computeDiff) {
                var fieldName = e.field.field;
                computeDiff = function (x, y) {
                    if (fieldName) {
                        x = x[fieldName];
                        y = y[fieldName];
                    }

                    return u.isString(x) &amp;&amp; u.isString(y)
                        ? x.localeCompare(y)
                        : x - y;
                };
            }

            function compare(x, y) {
                var diff = computeDiff(x, y);
                return e.order === 'asc' ? diff : -diff;
            }

            var datasource = this.datasource;
            datasource.sort(compare);
            this.setDatasource(datasource);
        }

<span id='extension-AutoSort-method-activate'>        /**
</span>         * 激活扩展
         *
         * @override
         */
        AutoSort.prototype.activate = function () {
            // 只对`Table`控件生效
            if (!(this.target instanceof Table)) {
                return;
            }

            this.target.on('sort', sort);

            Extension.prototype.activate.apply(this, arguments);
        };

<span id='extension-AutoSort-method-inactivate'>        /**
</span>         * 取消扩展的激活状态
         *
         * @override
         */
        AutoSort.prototype.inactivate = function () {
            // 只对`Table`控件生效
            if (!(this.target instanceof Table)) {
                return;
            }

            this.target.un('sort', sort);

            Extension.prototype.inactivate.apply(this, arguments);
        };

        require('../lib').inherits(AutoSort, Extension);
        require('../main').registerExtension(AutoSort);
        return AutoSort;
    }
);
</pre>
</body>
</html>
